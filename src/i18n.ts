import { useCallback, useEffect, useMemo, useState } from 'react'

export type Locale = 'es' | 'en'

const TRANSLATIONS: Record<Locale, Record<string, string>> = {
  es: {
    title: 'Plataforma Miniko',
    subtitle: 'Rápido + asistencia de IA (no es estable aún) + aún en desarrollo :)',
    pill: '',
    blocksTitle: 'Bloques de código',
    supportedLabel: 'Lenguajes soportados',
    blocksDesc: 'Pega cualquier lenguaje y Miniko lo detecta automáticamente.',
    designedBy: 'Diseñado por Mariana-CodeBase · © {year}',
    detected: 'Detectado',
    runDetected: 'Ejecutar sandbox',
    demoPy: 'Demo Python',
    demoJs: 'Demo JS',
    testCodesTitle: 'Test codes',
    testPython: 'Python',
    testJava: 'Java',
    testTs: 'TypeScript',
    testC: 'C',
    testCpp: 'C++',
    testCs: 'C#',
    testGo: 'Go',
    testRust: 'Rust',
    logicTitle: 'Lógica de ejecución',
    logicDesc: 'Avanza y retrocede paso a paso para entender el flujo.',
    output: 'Salida',
    noOutput: 'Sin salida todavía.',
    trace: 'Traza',
    noTrace: 'No hay pasos para mostrar.',
    step: 'Paso',
    line: 'Línea',
    state: 'Estado',
    note: 'Nota',
    changes: 'Cambios',
    operation: 'Operación',
    noOperation: 'Sin operación',
    outputLine: 'Salida en este paso',
    stepBack: 'Atrás',
    stepForward: 'Siguiente',
    timedOut: 'Tiempo límite alcanzado.',
    anyOutput: 'Este lenguaje se analiza con IA; la ejecución directa está limitada.',
    aiTitle: 'Miniko AI',
    aiDesc: 'Explica la intención del código y resalta riesgos.',
    aiTokenManaged: 'Token IA',
    aiTokenManagedDesc: 'Administrado por el sistema (no visible para el usuario).',
    aiPrompt: 'Pregunta',
    aiPromptPlaceholder: '¿Qué hace este bloque?',
    aiExplain: 'Analizar con IA',
    aiWorking: 'Analizando…',
    aiEmpty: 'La respuesta aparecerá aquí.',
    aiFallback: 'Respuesta no disponible. Se usó resumen local.',
    aiError: 'Error de IA:',
    aiRateLimited: 'El servicio de IA está temporalmente saturado. Intenta en unos minutos.',
    aiInsufficientCredits: 'Créditos insuficientes para completar la solicitud de IA.',
    aiOpen: 'Abrir IA',
    aiClose: 'Cerrar',
    aiExplainBtn: 'Explicación con IA',
    aiCode: 'Código actual',
    aiDefaultPrompt: 'Explica el flujo de ejecución.',
    themeLight: 'Claro',
    themeDark: 'Oscuro',
    language: 'Idioma',
    theme: 'Tema',
    principlesTitle: 'Principios Miniko',
    principle1: 'Comprensible: cada ejecución tiene historia.',
    principle2: 'Rápido: feedback instantáneo.',
    principle3: 'Seguro: sandbox y límites de tiempo.',
    docsTitle: 'Guía rápida',
    docs1: 'El visor interpreta un subconjunto de cada lenguaje.',
    docs2: 'Usa ejemplos cortos y evita librerías externas, aún estámos en desarrollo :)',
    docs3: 'Si algo falla, simplifica el código y revisa paso a paso.',
    docs4: 'Ideal para escritorio, pero responsive en cualquier dispositivo.',
    safetyNote: 'Se ejecuta en sandbox local.',
    code: 'Código',
    frames: 'Frames',
    noVariables: 'Sin variables',
    noChanges: 'Sin cambios en este paso',
  },
  en: {
    title: 'Miniko Platform',
    subtitle: 'Fast + AI assistance (not stable yet) + still in development :)',
    pill: '',
    blocksTitle: 'Code blocks',
    supportedLabel: 'Supported languages',
    blocksDesc: 'Paste any language and Miniko detects it automatically.',
    designedBy: 'Designed by Mariana-CodeBase · © {year}',
    detected: 'Detected',
    runDetected: 'Run in sandbox',
    demoPy: 'Python demo',
    demoJs: 'JS demo',
    testCodesTitle: 'Test codes',
    testPython: 'Python',
    testJava: 'Java',
    testTs: 'TypeScript',
    testC: 'C',
    testCpp: 'C++',
    testCs: 'C#',
    testGo: 'Go',
    testRust: 'Rust',
    logicTitle: 'Execution logic',
    logicDesc: 'Step forward and back to understand the flow.',
    output: 'Output',
    noOutput: 'No output yet.',
    trace: 'Trace',
    noTrace: 'No steps to show.',
    step: 'Step',
    line: 'Line',
    state: 'State',
    note: 'Note',
    changes: 'Changes',
    operation: 'Operation',
    noOperation: 'No operation',
    outputLine: 'Output on this step',
    stepBack: 'Back',
    stepForward: 'Next',
    timedOut: 'Time limit reached.',
    anyOutput: 'This language is AI-reviewed; direct execution is limited.',
    aiTitle: 'Miniko AI',
    aiDesc: 'Explains intent and highlights risks.',
    aiTokenManaged: 'AI token',
    aiTokenManagedDesc: 'System-managed (not visible to the user).',
    aiPrompt: 'Question',
    aiPromptPlaceholder: 'What does this block do?',
    aiExplain: 'Explain with AI',
    aiWorking: 'Analyzing…',
    aiEmpty: 'The answer appears here.',
    aiFallback: 'Answer unavailable. Used local summary.',
    aiError: 'AI error:',
    aiRateLimited: 'The AI service is temporarily rate-limited. Please try again soon.',
    aiInsufficientCredits: 'Not enough credits to complete the AI request.',
    aiOpen: 'Open AI',
    aiClose: 'Close',
    aiExplainBtn: 'AI explanation',
    aiCode: 'Current code',
    aiDefaultPrompt: 'Explain the execution flow.',
    themeLight: 'Light',
    themeDark: 'Dark',
    language: 'Language',
    theme: 'Theme',
    principlesTitle: 'Miniko principles',
    principle1: 'Readable: every run has a story.',
    principle2: 'Fast: instant feedback.',
    principle3: 'Safe: sandbox + time limits.',
    docsTitle: 'Quick guide',
    docs1: 'The viewer interprets a subset of each language.',
    docs2: 'Use short examples and avoid external libraries.',
    docs3: 'If something fails, simplify the code and step through it, we are still in development :) ',
    docs4: 'Ideal for desktop, but responsive on any device.',
    safetyNote: 'Runs inside a local sandbox.',
    code: 'Code',
    frames: 'Frames',
    noVariables: 'No variables',
    noChanges: 'No changes in this step',
  },
}

export function useI18n() {
  const [locale, setLocale] = useState<Locale>(() => {
    const stored = localStorage.getItem('miniko-locale')
    return stored === 'es' || stored === 'en' ? stored : 'es'
  })

  useEffect(() => {
    localStorage.setItem('miniko-locale', locale)
  }, [locale])

  const t = useCallback(
    (key: string, vars?: Record<string, string | number>) => {
      let value = TRANSLATIONS[locale][key] ?? key
      if (vars) {
        Object.entries(vars).forEach(([name, replacement]) => {
          value = value.replaceAll(`{${name}}`, String(replacement))
        })
      }
      return value
    },
    [locale]
  )

  const value = useMemo(() => ({ locale, setLocale, t }), [locale, t])
  return value
}
